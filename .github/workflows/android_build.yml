name: Android Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Godot
      uses: firebelley/godot-export@v5.2.0
      with:
        godot_executable_download_url: "https://downloads.tuxfamily.org/godotengine/4.3/Godot_v4.3-stable_linux_headless.64.zip"
        godot_export_templates_download_url: "https://downloads.tuxfamily.org/godotengine/4.3/Godot_v4.3-stable_export_templates.tpz"

    - name: Verify Data Files
      run: |
        echo "Checking Data folder..."
        if [ ! -d "Data" ]; then mkdir Data; fi
        if [ ! -f "Data/buildings.json" ]; then echo "[]" > Data/buildings.json; fi
        if [ ! -f "Data/npc.json" ]; then echo "[]" > Data/npc.json; fi
        if [ ! -f "Data/economy.json" ]; then echo "{}" > Data/economy.json; fi
        echo "Data verification complete."

    - name: Build Android APK
      run: |
        mkdir -p build/android
        godot --headless --export-release "Android" build/android/app-release.apk
